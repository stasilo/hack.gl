<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>hack.gl</title>
  </head>
  <body>
    <canvas id="webgl" style="display:block;margin:0 auto;">
        Please use a browser that supports canvas and webgl
    </canvas>
    <script src="../dist/hackgl.js"></script>
    <script>
        let canvas = document.getElementById('webgl');

        hackgl({
            canvas,
            clearColor: [0.0, 0.0, 0.0, 1.0],
            resolution: {
                width: 800,
                height: 400
            },
            feedbackFbo: {
                injectWebcamUniform: true,
                uniforms: {
                    u_texture1: {
                        type: 't',
                        value: null,
                        url: 'assets/sky.jpg'
                    }
                },
                fragmentShader: `
                    uniform sampler2D u_texture1;

                    void main() {
                        vec2 uv = gl_FragCoord.xy / u_resolution.xy;
                        vec2 tc = uv;

                        uv *= 0.991;

                        vec2 coords = vec2(
                            0.5 + uv.x * abs(cos(u_time)*0.5),
                            0.5 + uv.y * abs(sin(u_time+uv.x*1.0)*0.5)
                        );

                        vec4 src = texture2D(u_fbo, uv);

                        vec4 src2 = texture2D(u_texture1, coords);
                        vec4 sum = texture2D(u_camera, tc);

                        sum.rgb = mix(sum.rgb, src2.rgb, 0.25);
                        sum.rgb = mix(sum.rbg, src.rgb, 0.95);

                        gl_FragColor = sum;
                    }
                `
            },
            fragmentShader: `
                uniform sampler2D u_texture1;

                void main() {
                    vec2 uv = gl_FragCoord.xy / u_resolution.xy;
                    gl_FragColor = texture2D(u_fbo, uv);
                }
            `,
        });
    </script>
  </body>
</html>
